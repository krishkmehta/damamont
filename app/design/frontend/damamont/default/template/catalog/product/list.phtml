<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magento.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magento.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2006-2015 X.commerce, Inc. (http://www.magento.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<div class="single_collection">
    <div class="collection_img"
         style="background-image: url('http://127.0.0.1/montecarlo2/pub/media/17_Pearlfect_Ch_17_3_Strand_Bracelet_3_Strand_White_Ring_Large_Wh_Pearl_Studs_b41d2800-b1cb-4c35-baf8-d29eb923df42.jpg">
        <img style="display: none;"
             src="http://127.0.0.1/montecarlo2/pub/media/17_Pearlfect_Ch_17_3_Strand_Bracelet_3_Strand_White_Ring_Large_Wh_Pearl_Studs_b41d2800-b1cb-4c35-baf8-d29eb923df42.jpg"
             width="270" height="180">
    </div>
    <div class="collection_text">
        <h5>WHAT A PEARL</h5>
        <div class="box"><img src="http://127.0.0.1/montecarlo2/pub/media/logo/dama-logo.png" width="80" height="20"
                              alt="Logo">
            <p>"Pearl-fect"</p>
        </div>
    </div>
</div>
<?php
/**
 * Product list template
 *
 * @see Mage_Catalog_Block_Product_List
 */
?>
<?php $currentCategory = Mage::registry('current_category') ?>
<?php

/* Load category by id*/
$cat = Mage::getModel('catalog/category')->load($currentCategory->getId());


/*Returns comma separated ids*/
$subcats = $cat->getChildren();

//Print out categories string

$subats_ids = explode(',', $subcats);
$cat_ids = array_filter($subats_ids);
?>
<div class="container-fluid collection-wrap">
    <div class="row">
        <?php if (count($cat_ids) > 0) { ?>
            <div class="container mallz">
                <div class="collection-row">

                    <?php foreach ($subats_ids as $subCatid) : ?>
                        <?php $_category = Mage::getModel('catalog/category')->load($subCatid);
                        ?>
                        <?php if ($_category->getIsActive()) : ?>
                            <?php
                            $caturl = $_category->getURL();
                            $catname = $_category->getName();
                            if ($_category->getImageUrl()) {
                                $catimg = $_category->getImageUrl();
                            }
                            ?>

                            <div class="single-collection collections-single">
                                <div class="collection-image"
                                     style="background-image: url('<?php
                                     echo $catimg ?>');">

                                    <a href="<?php echo $caturl ?>"
                                       style="background-image: url('<?php echo $catimg ?>);">
                                        <img src="<?php echo $catimg; ?>" alt="<?php echo $catname; ?>"
                                             class="img-responsive"
                                             height="750"
                                             width="674"
                                             style="display: none;">
                                        <div class="collection-detail">
                                            <p class="collection-title" style=""><?php echo $catname; ?></p>
                                            <p class="shop-now-btn"> SHOP ACRYLIC&nbsp; </p>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        <?php endif; ?>
                    <?php endforeach; ?>
                </div>
            </div>
        <?php
        } else {
        ?>
        <?php
        $_productCollection = $this->getLoadedProductCollection();
        $_helper = $this->helper('catalog/output');
        ?>
        <?php if (!$_productCollection->count()): ?>
            <p class="note-msg"><?php echo $this->__('There are no products matching the selection.') ?></p>
        <?php else: ?>
            <div class="category-products">
                <?php //echo $this->getToolbarHtml() ?>
                <?php if ($this->getMode() != 'grid'): ?>
                <?php $_iterator = 0; ?>
                `
                <?php foreach ($_productCollection as $_product): ?>
                    <div class="single_collection">
                        <div class="collection_img"
                             style="background-image: url(<?php $this->helper('catalog/image')->init($_product, 'small_image')->resize(270, 180); ?>)">
                            <img style="display: none;"
                                 src="<?php $this->helper('catalog/image')->init($_product, 'small_image')->resize(270, 180); ?>"
                                 width="270" height="180">
                        </div>
                        <div class="collection_text">
                            <h5><a href="<?php echo $_product->getProductUrl() ?>"><?php echo
                                $_helper->productAttribute($_product, $_product->getName(), 'name'); ?></a></h5>
                            <div class="box"><img
                                        src="//cdn.shopify.com/s/files/1/2405/7229/t/8/assets/Dama-Logo.svg?0"
                                        width="80" height="20" alt="Logo">
                                <p> <?php
                                    echo $_product->getResource()->getAttribute('c_perl')->getFrontend()->getValue($_product);
                                    ?></p>
                            </div>
                        </div>
                    </div>

                <?php endforeach; ?>
            </div>
            <script type="text/javascript">decorateList('products-list', 'none-recursive')</script>

        <?php else: ?>

        <?php // Grid Mode ?>

        <?php $_collectionSize = $_productCollection->count() ?>
        <?php $_columnCount = $this->getColumnCount(); ?>
        <?php $i = 0;
        foreach ($_productCollection

        as $_product): ?>
            <div class="single_collection">
                <div class="collection_img"
                     style="background-image: url(<?php $this->helper('catalog/image')->init($_product,
                         'small_image')->resize(270, 180); ?>)">
                    <img style="display: none;"
                         src="<?php $this->helper('catalog/image')->init($_product, 'small_image')->resize(270, 180); ?>"
                         width="270" height="180">
                </div>
                <div class="collection_text">
                    <h5><a href="<?php echo $_product->getProductUrl() ?>"><?php echo
                        $_helper->productAttribute($_product, $_product->getName(), 'name'); ?></a></h5>
                    <div class="box"><img
                                src="//cdn.shopify.com/s/files/1/2405/7229/t/8/assets/Dama-Logo.svg?0"
                                width="80" height="20" alt="Logo">
                        <p> <?php
                            echo $_product->getResource()->getAttribute('c_perl')->getFrontend()->getValue($_product);
                            ?></p>
                    </div>
                </div>
            </div>
        <?php endforeach ?>
            <script type="text/javascript">decorateGeneric($$('ul.products-grid'), ['odd', 'even', 'first', 'last'])</script>
        <?php endif; ?>

        <?php endif; ?>
        <?php } ?>
    </div>
</div>